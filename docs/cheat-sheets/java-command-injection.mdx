---
slug: java-command-injection
---

import LinkToRegistryRule from "/src/components/LinkToRegistryRule"

# Command injection prevention for Java

This is command injection prevention cheat sheet by r2c. It contains code patterns of potential ways to run an OS command or arbitrary code in an application. Instead of scrutinizing code for exploitable vulnerabilities, the recommendations in this cheat sheet pave a safe road for developers that mitigates the possibility of command injection in your code. By following these recommendations, you can be reasonably sure your code is free of command injection.

#### Check your project for these conditions:

```bash
semgrep --config p/go-command-injection
```

---

## 1. Running an OS command

### 1.A. Running OS commands with `Runtime.getRuntime().exec()`

`exec` executes the specified string command in a separate process. This is dangerous if a command string is controlled by user input and could result in a command injection.

Example:

```java
Runtime.getRuntime().exec("ls -la")
```

#### References

- [`exec` documentation](https://docs.oracle.com/javase/7/docs/api/java/lang/Runtime.html#exec(java.lang.String))

#### Mitigation

Try to avoid non-literal values for the command string. If it is not possible, then do not let running arbitrary commands, use a white list for inputs. Strip `!@#$;&*~"'{}][-+%^` characters from an input provided for command string. 

#### Semgrep rule

<LinkToRegistryRule ruleId="java.lang.security.audit.command-injection-formatted-runtime-call.command-injection-formatted-runtime-call" />

### 1.B. Running OS processes with ProcessBuilder

ProcessBuilder class is used to create operating system processes. If the command string is controlled by user input it could result in command injection. 
Example:

```java
Process p = new ProcessBuilder("ls", "-la").start();
```

#### References

[`ProcessBuilder` documentation](https://docs.oracle.com/javase/7/docs/api/java/lang/ProcessBuilder.html)

#### Mitigation

Try to avoid non-literal values for the command string. If it is not possible, then do not let running arbitrary commands, use a white list for inputs. Do not put command arguments in a command string, use parameterization instead. (TODO: explain it) 

#### Semgrep rule

<LinkToRegistryRule ruleId="java.lang.security.audit.command-injection-process-builder.command-injection-process-builder" />

## 2. Unsafe Reflection

### 2.A. Using reflection with Class.forName

`Class.forName` returns the Class object associated with the class or interface with the given string name. If an attacker can supply values that the application then uses to determine which class to instantiate or which method to invoke, the potential exists for the attacker to create control flow paths through the application that were not intended by the application developers. This attack vector may allow the attacker to bypass authentication or access control checks or otherwise cause the application to behave in an unexpected manner. 
Example:

```java
Class t = Class.forName("java.lang.Thread")
```

#### References

- [`Class.forName` documentation](https://docs.oracle.com/javase/8/docs/api/java/lang/Class.html#forName-java.lang.String-)

#### Mitigation

Try to avoid non-literal values for the command string. If it is not possible, then do not let running arbitrary commands, use a white list for inputs. 

#### Semgrep rule

<LinkToRegistryRule ruleId="java.lang.security.audit.unsafe-reflection.unsafe-reflection" />
